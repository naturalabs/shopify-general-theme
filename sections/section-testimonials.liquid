{{ 'section-multicolumn.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}
<style>
  .testimonial-grid-3 {
    display: grid;
    grid-template-columns: 1fr;
  }
  .testimonial-grid-3 li {
    border-bottom: 1px solid #c3c3c3;
    margin-bottom: 40px;
  }

  .user-block {
    display: flex;
    justify-content: space-between;
  }
  .user-wrapper {
    display: flex;
  }
  .user-wrapper p.verified {
    font-size: 18px;
    color: #3cb36c;
  }
  .testimonial-image {
    margin-right: 30px;
  }
  .testimonial-multicolumn-card {
    width: 100%;
  }
  .comment-block {
    width: 80%;
  }
  .likes-block {
    display: flex;
    justify-content: flex-end;
  }
  .likes-wrapper {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 32px;
  }
  .likes-wrapper p {
    margin-right: 20px;
  }
</style>
{%- liquid
  assign columns_mobile_int = section.settings.columns_mobile | plus: 0
  assign show_mobile_slider = false
  if section.settings.swipe_on_mobile and section.blocks.size > columns_mobile_int
    assign show_mobile_slider = true
  endif
-%}
<div class="multicolumn color-{{ section.settings.color_scheme }} gradient{% unless section.settings.background_style == 'none' and settings.text_boxes_border_thickness > 0 or settings.text_boxes_shadow_opacity > 0 %} background-{{ section.settings.background_style }}{% endunless %}{% if section.settings.title == blank %} no-heading{% endif %}">
  <div
    class="page-width section-{{ section.id }}-padding isolate{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
    {% if settings.animations_reveal_on_scroll %}
      data-cascade
    {% endif %}
  >
    <div class="{{ section.settings.content_alignment }}">
      <h2
        class="section-benefits__heading rich-text__heading rte inline-richtext {{ section.settings.heading_size }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
        {{ block.shopify_attributes }}
        {% if settings.animations_reveal_on_scroll %}
          data-cascade
          style="--animation-order: {{ forloop.index }};"
        {% endif %}
      >
        {{ section.settings.heading }}
      </h2>
    </div>
    <slider-component class="slider-mobile-gutter">
      <ul
        class=" testimonial-grid-3"
        id="Slider-{{ section.id }}"
        role="list"
      >
        {%- liquid
          assign highest_ratio = 0
          for block in section.blocks
            if block.settings.image.aspect_ratio > highest_ratio
              assign highest_ratio = block.settings.image.aspect_ratio
            endif
          endfor
        -%}
        {%- for block in section.blocks -%}
          {%- assign empty_column = '' -%}
          {%- if block.settings.image == blank
            and block.settings.title == blank
            and block.settings.text == blank
            and block.settings.link_label == blank
          -%}
            {%- assign empty_column = ' multicolumn-list__item--empty' -%}
          {%- endif -%}

          <li
            id="Slide-{{ section.id }}-{{ forloop.index }}"
            class=" block-{{ forloop.index }}"
            {{ block.shopify_attributes }}
            {% if settings.animations_reveal_on_scroll %}
              data-cascade
              style="--animation-order: {{ forloop.index }};"
            {% endif %}
          >
            <div class="testimonial-multicolumn-card content-container">
              <div class="">
                {% case block.type %}
                  {% when 'testimonial' %}
                    <div class="testimonial-block">
                      <div class="user-block">
                        <div class="user-wrapper">
                          <div class="testimonial-image">
                            {% if block.settings.image != blank %}
                              <img
                                src="{{ block.settings.image.src | image_url }}"
                                alt="Icon"
                                loading="lazy"
                                width="100"
                                height="100"
                              >
                            {% else %}
                              {% render 'icon-placeholder' %}
                            {% endif %}
                          </div>

                          <div class="user-rating-wrapper">
                            <p>{{ block.settings.name }}</p>

                            {% assign rating = block.settings.rating | floor %}
                            {% assign has_half_star = block.settings.rating | modulo: 1 %}
                            {% assign total_stars = rating %}

                            <div class="">
                              <div class="star-rating">
                                {% liquid
                                  for i in (1..rating)
                                    render 'icon-star-full'
                                  endfor
                                %}
                                {% if has_half_star > 0 %}
                                  {%- render 'icon-star-half' -%}
                                  {% assign total_stars = total_stars | plus: 1 %}
                                {% endif %}
                              </div>
                            </div>
                          </div>

                          <p class="verified">{{ block.settings.verified_buyer }}</p>
                        </div>
                        <div class="date-wrapper">12/15/2023</div>
                      </div>
                    </div>
                    <div class="comment-block">
                      <p>{{ block.settings.comment }}</p>
                    </div>
                    <div class="likes-block">
                      <div class="likes-wrapper">
                        <p>Find this helpful?</p>
                        {%- render 'icon-thumb-up' -%}
                        <p>{{ block.settings.thumb_up }}</p>
                        {%- render 'icon-thumb-down' -%}
                        <p>{{ block.settings.thumb_down }}</p>
                      </div>
                    </div>
                {% endcase %}
              </div>
            </div>
          </li>
        {%- endfor -%}
      </ul>

      {%- if show_mobile_slider -%}
        <div class="slider-buttons no-js-hidden medium-hide">
          <button
            type="button"
            class="slider-button slider-button--prev"
            name="previous"
            aria-label="{{ 'general.slider.previous_slide' | t }}"
          >
            {% render 'icon-caret' %}
          </button>
          <div class="slider-counter caption">
            <span class="slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">{{ 'general.slider.of' | t }}</span>
            <span class="slider-counter--total">{{ section.blocks.size }}</span>
          </div>
          <button
            type="button"
            class="slider-button slider-button--next"
            name="next"
            aria-label="{{ 'general.slider.next_slide' | t }}"
          >
            {% render 'icon-caret' %}
          </button>
        </div>
      {%- endif -%}
    </slider-component>
    <div class="center{% if show_mobile_slider %} small-hide medium-hide{% endif %}">
      {%- if section.settings.button_label != blank -%}
        <a
          class="button button--primary"
          {% if section.settings.button_link == blank %}
            role="link" aria-disabled="true"
          {% else %}
            href="{{ section.settings.button_link }}"
          {% endif %}
        >
          {{ section.settings.button_label | escape }}
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Testimonials",
  "settings": [
    {
      "type": "select",
      "id": "desktop_content_position",
      "options": [
        {
          "value": "left",
          "label": "t:sections.rich-text.settings.desktop_content_position.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.rich-text.settings.desktop_content_position.options__2.label"
        },
        {
          "value": "right",
          "label": "t:sections.rich-text.settings.desktop_content_position.options__3.label"
        }
      ],
      "default": "center",
      "label": "t:sections.rich-text.settings.desktop_content_position.label",
      "info": "t:sections.rich-text.settings.desktop_content_position.info"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "options": [
        {
          "value": "left",
          "label": "t:sections.rich-text.settings.content_alignment.options__1.label"
        },
        {
          "value": "center",
          "label": "t:sections.rich-text.settings.content_alignment.options__2.label"
        },
        {
          "value": "right",
          "label": "t:sections.rich-text.settings.content_alignment.options__3.label"
        }
      ],
      "default": "center",
      "label": "t:sections.rich-text.settings.content_alignment.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "background-1"
    },
    {
      "type": "checkbox",
      "id": "full_width",
      "default": true,
      "label": "t:sections.rich-text.settings.full_width.label"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 40
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 52
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial Block",
      "settings": [
        {
          "type": "text",
          "id": "name",
          "label": "Name",
          "default": "Name/Last Name"
        },
        {
          "type": "range",
          "id": "rating",
          "label": "rating",
          "default": 5,
          "min": 0,
          "max": 5,
          "step": 0.5
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "verified_buyer",
          "label": "Verified Buyer",
          "default": "Verified Buyer"
        },
        {
          "type": "textarea",
          "id": "comment",
          "label": "Comment",
          "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."
        },
        {
          "type": "text",
          "id": "thumb_up",
          "label": "Thumb up value",
          "default": "0"
        },
        {
          "type": "text",
          "id": "thumb_down",
          "label": "Thumb down value",
          "default": "0"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "testimonial"
    }
  ]
}
{% endschema %}
